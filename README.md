# 動物・家畜の血統関係を整理したエクセルファイルを出力するプログラム

酪農に携わる親戚に以下のように相談されました。

「乳牛1頭ごとに検査データを持っており、祖先のデータまで遡って血統関係を整理した上で統計解析にかけたい。しかし血統関係がわかる特徴量として使えるものが、母牛のIDしかない。そこで各牛のエクセルデータから祖先まで遡った血統樹のエクセルデータを出力するようなプログラムを作って欲しい。」

「blood_tree_xlsx_(乳牛の血統樹のエクセルファイル)の作成用.ipynb」はこの要件を達成するために作られたプログラムです。

⚠︎このプログラムではGoogleColabとGoogleDriveを利用します。GoogleDriveの「マイドライブ」に対象の元データを格納したフォルダを作る必要があります。「blood_tree_xlsx_(乳牛の血統樹のエクセルファイル)の作成用.ipynb」では「乳牛データ」という名前のフォルダを作って各牛のデータを格納しています。

ごく簡単にプログラムのロジックを説明しますと、
エクセルファイルからpandasデータフレームに変換した後、血統関係を整理するために各牛の母牛IDを第一世代まで辿っていき、各牛のIDを１行のベクトルにして繋げていきます。こうしてできた複数の行ベクトルにおいて、長いものを優先的に残すようにして重複している箇所を削除します。
最終的に残った複数の行ベクトルは血統樹(樹形図)における「線」になります。

この１つ１つの行ベクトルにおける各成分は血統関係にある牛たちのIDであるため、このIDの順番通りに元の乳牛データを並べ替えて行って新たなエクセルファイルを出力します。

こうして出力された新たなエクセルファイルは血統関係にある牛たちのデータが並んだ「血統関係を整理した」エクセルファイルになります。

このプログラムはもともと「乳牛用」に作成されたものではありますが、「母親」の情報を持つ動物のエクセルデータであれば同様のロジックが使えますので、適宜プログラムを変更すればどのような動物のデータでも「血統関係を整理した」エクセルファイルを作る事ができます。
